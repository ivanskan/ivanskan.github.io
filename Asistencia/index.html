<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Pkcorp | Asistenica</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
<body class="container">

  <h2>Sube la lista de participantes (.xlsx)</h2>

  <div class="mb-3 col-12 col-md-4">
    <input class="form-control form-control-sm" type="file" id="input-excel" accept=".xlsx">
  </div>

  <div id="registro" style="display:none;">
    <h3>Buscar por DNI</h3>
    <input type="text" id="dni-input" placeholder="Ingrese DNI" />
    <button class="btn btn-primary" onclick="registrarAsistencia()">Registrar Asistencia</button>
  </div>

  <div style="margin-top:30px;">
  <button id="btnMostrarAgregar" class="btn btn-primary" onclick="mostrarAgregar()">Agregar participante</button>
  <button id="btnMostrarLista" onclick="mostrarLista()" style="display:none;" class="btn btn-primary">Volver a lista</button>
</div>

<!-- <div id="formAgregar" style="display:none; margin-top:20px; padding: 10px; border: 1px solid #ccc; background: #fafafa;">
  <h3>Agregar nuevo participante</h3>
  <label>DNI: <input type="text" id="inputNuevoDNI" /></label><br /><br />
  <label>Apellidos y Nombres: <input type="text" id="inputNuevoNombre" /></label><br /><br />
  <label>Puesto de trabajo: <input type="text" id="inputNuevoPuesto" /></label><br /><br />
  <label>EMPRESA: <input type="text" id="inputNuevoEmpresa" /></label><br /><br />
  <label>Fecha (dd-mm-yyyy): <input type="text" id="inputNuevoFecha" placeholder="Opcional" /></label><br /><br />
  <button onclick="agregarParticipante()">Guardar</button>
</div> -->

<div id="formAgregar" style="display:none;">
  <form>
  <div class="row mb-3">
    <label for="inputNuevoDNI" class="col-sm-2 col-form-label">DNI</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" id="inputNuevoDNI">
    </div>
  </div>
  <div class="row mb-3">
    <label for="inputNuevoNombre" class="col-sm-2 col-form-label">Apellidos y Nombres</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" id="inputNuevoNombre">
    </div>
  </div>
  <div class="row mb-3">
    <label for="inputNuevoPuesto" class="col-sm-2 col-form-label">Puesto</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" id="inputNuevoPuesto">
    </div>
  </div>
  <div class="row mb-3">
    <label for="inputNuevoEmpresa" class="col-sm-2 col-form-label">Empresa</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" id="inputNuevoEmpresa">
    </div>
  </div>
  <div class="row mb-3">
    <label for="inputNuevoFecha" class="col-sm-2 col-form-label">Fecha (dd-mm-yyyy)</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" id="inputNuevoFecha" placeholder="Opcional"> 
    </div>
  </div>
  <button type="submit" class="btn btn-primary" onclick="agregarParticipante()">Guardar</button>
</form>
</div>



  <div id="mensaje"></div>
  <div id="tabla-container"></div>
  <button id="descargar-btn" style="display:none" class="btn btn-primary" onclick="descargarExcel()">Descargar Excel actualizado</button>

  <script src="asistencia.js"></script>
  <script>
    function mostrarAgregar() {
  document.getElementById('formAgregar').style.display = 'block';
  document.getElementById('registro').style.display = 'none';
  document.getElementById('tabla-container').style.display = 'none';
  document.getElementById('descargar-btn').style.display = 'none';
  document.getElementById('mensaje').innerText = '';
  document.getElementById('btnMostrarAgregar').style.display = 'none';
  document.getElementById('btnMostrarLista').style.display = 'inline-block';
}

function mostrarLista() {
  document.getElementById('formAgregar').style.display = 'none';
  document.getElementById('registro').style.display = 'block';
  document.getElementById('tabla-container').style.display = 'block';
  document.getElementById('descargar-btn').style.display = 'inline-block';
  document.getElementById('mensaje').innerText = '';
  document.getElementById('btnMostrarAgregar').style.display = 'inline-block';
  document.getElementById('btnMostrarLista').style.display = 'none';
}

function agregarParticipante() {
  const dni = document.getElementById('inputNuevoDNI').value.trim();
  const nombre = document.getElementById('inputNuevoNombre').value.trim();
  const puesto = document.getElementById('inputNuevoPuesto').value.trim();
  const empresa = document.getElementById('inputNuevoEmpresa').value.trim();
  let fecha = document.getElementById('inputNuevoFecha').value.trim();

  if (!dni || !nombre) {
    alert('DNI y Apellidos y Nombres son obligatorios.');
    return;
  }

  // Si no hay fecha, ponemos fecha actual en formato dd-mm-yyyy
  if (!fecha) {
    const hoy = new Date();
    const dia = String(hoy.getDate()).padStart(2, '0');
    const mes = String(hoy.getMonth() + 1).padStart(2, '0');
    const anio = hoy.getFullYear();
    fecha = `${dia}-${mes}-${anio}`;
  }

  // Verificar que no exista DNI repetido
  const existe = data.some(row => row.DNI === dni);
  if (existe) {
    alert('El DNI ya existe en la lista.');
    return;
  }

  // Crear nuevo participante con estructura similar a las filas importadas
  const nuevo = {
    ITEM: data.length + 1,
    DNI: dni,
    'Apellidos y Nombres': nombre,
    'Puesto de trabajo': puesto,
    EMPRESA: empresa,
    Fecha: fecha,
    Asistencia: '',
    'Hora de asistencia': ''
  };

  data.push(nuevo);
  mostrarTabla(data);
  alert('Participante agregado correctamente.');

  // Limpiar campos
  document.getElementById('inputNuevoDNI').value = '';
  document.getElementById('inputNuevoNombre').value = '';
  document.getElementById('inputNuevoPuesto').value = '';
  document.getElementById('inputNuevoEmpresa').value = '';
  document.getElementById('inputNuevoFecha').value = '';

  mostrarLista();
}

  </script>
</body>
</html>
